(function(){function n(a,b){}function p(a,b,c){a=document.createElement(a);a[b]=c;document.body.appendChild(a);return a}function v(){m&&document.body.removeChild(m)}function q(a,b){b&&(b.disabled=!1);if(g!==n)g(0,a);else{var c=document.createElement("p");c.innerText=a;document.body.insertBefore(c,document.body.firstChild);m=c;window.setTimeout(v,5E3)}}function w(a){h?(h=!1,k.removeItem("session"),e.innerText="login",g(3,f)):(e.disabled=!0,c.retry?c.retry():r())}function t(){h=!0;var a=e=document.createElement("button"),
b=a.style;a.innerText="logout";a.onclick=w;b.border="none";b.background="transparent";b.position="fixed";b.cursor="pointer";b.right="2px";x&1?b.top="2px":b.bottom="2px";document.body.appendChild(a);(a=c.start)&&p("script","src",a);g(1,f)}function r(){c.handleOauth=function(a,b){if(b)if(!a)q(b,e);else if(b.es_token){var d=y[c.idx];64!==d.charCodeAt(0)&&d!==b.es_user?q("Unknown user "+b.es_user,e):(f=b,k.setItem("session",JSON.stringify({auth_data:b,user:null})),e?(h=!0,e.innerText="logout",e.disabled=
!1,g(2,f)):window.setTimeout(t,100))}};window.auth_config=c;p("script","src","/login.js")}function u(a){if(401===a||Array.isArray(a)&&3===array[0])k.removeItem("session"),c.retry();throw a;}var k=window.localStorage,l=k.getItem("session"),f=(l=l&&JSON.parse(l))&&l.auth_data,c=window.auth_config,x=c.flags||0,g=c.on||n,y=c.users,h=!1,m,e,d;window.rpc_config={auth$$:null,get$$:function(a,b){d||(d=window.rpc_config_d);return d.get$$(a+"?access_token="+f.es_token,b).then(void 0,u)},post$$:function(a,b){d||
(d=window.rpc_config_d);return d.post$$(a+"?access_token="+f.es_token,b).then(void 0,u)}};f?t():r()})();
