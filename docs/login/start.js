(function(){function A(a){a=JSON.parse(a.data);Array.isArray(a)&&3===a.length&&a[2]===m&&c.handleOauth(a[0],a[1])}function p(){for(var a="",b=0;10>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));m=a;a=c.users[c.idx];b=a.indexOf("@");a=-1!==a.indexOf(".",b+1)?"google":a.substring(b+1);(a=window.open(B+"#"+m+"~"+a+"~@"+c.host+"~"+window.location.href,"Login","width=450,height=500,location=1,status=1,resizable=yes"))&&a.moveTo(window.innerWidth/
2-225,window.innerHeight/2-250);return a}function q(a,b){a.onclick=C;a.innerText=b;return a}function D(){var a=document.createElement("button"),b=a.style;b.border="none";b.background="transparent";b.position="fixed";b.cursor="pointer";b.right="2px";r&1?b.top="2px":b.bottom="2px";return a}function t(a,b){}function E(){n&&document.body.removeChild(n)}function u(a,b){b&&(b.disabled=!1);if(g!==t)g(0,a);else{var c=document.createElement("p");c.innerText=a;document.body.insertBefore(c,document.body.firstChild);
n=c;window.setTimeout(E,5E3)}}function C(a){h?(h=!1,k.removeItem("session"),d.innerText="login",g(3,f)):(d.disabled=!0,c.retry?c.retry():v())}function w(){h=!0;d?(d.disabled=!1,d.innerText="logout"):document.body.appendChild(d=q(x(),"logout"));var a=c.start;if(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)}g(1,f)}function F(a,b){if(b)if(!a)u(b,d);else if(b.es_token){var e=G[c.idx];64!==e.charCodeAt(0)&&e!==b.es_user?u("Unknown user "+b.es_user,d):(f=b,k.setItem("session",
JSON.stringify({auth_data:b,user:null})),y?(y=!1,window.setTimeout(w,100)):(h=!0,d.innerText="logout",d.disabled=!1,g(2,f)))}}function v(){var a=window.addEventListener||window.attachEvent,b=window.addEventListener?"message":"onmessage",e=2===(r&2);c.retry=p;c.handleOauth=F;a(b,A,!1);!e&&p()||document.body.appendChild(d=q(x(),"login"))}function z(a){if(401===a||Array.isArray(a)&&3===array[0])k.removeItem("session"),c.retry();throw a;}var c=window.auth_config,B=c.proxy||"/login/",m,k=window.localStorage,
l=k.getItem("session"),f=(l=l&&JSON.parse(l))&&l.auth_data,c=window.auth_config,r=c.flags||0,g=c.on||t,x=c.btn||D,G=c.users,y=!0,h=!1,n,d,e;window.rpc_config={auth$$:null,get$$:function(a,b){e||(e=window.rpc_config_d);return e.get$$(a+"?access_token="+f.es_token,b).then(void 0,z)},post$$:function(a,b){e||(e=window.rpc_config_d);return e.post$$(a+"?access_token="+f.es_token,b).then(void 0,z)}};!c||!c.host||!Array.isArray(c.users)||c.idx>=c.users.length?console.log("Required auth_config fields: handleOauth (fn), host (https://example.com), idx (num), users (['user@github', 'user@gitlab'])"):
f?w():v()})();
